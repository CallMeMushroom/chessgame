# 中国象棋

[Github](https://github.com/CallMeMushroom/chessgame) | [“象棋”中文维基百科](https://zh.wikipedia.org/wiki/%E8%B1%A1%E6%A3%8B) | [wikipedia](https://en.wikipedia.org/wiki/Xiangqi)

在中国，这是简直不能再通俗的游戏了，随便抓个老大爷还是小学生下的都比我好。

## 操作说明

- 鼠标
  - 左键单击选中棋子，或选中棋子后选择其落点
  - 右键单击任意位置取消选中

- 快捷键
  - <kbd>Ctrl</kbd> + <kbd>Z</kbd> ：撤销上一步，可以连续撤销。
    - 大部分情况下是悔棋，虽说“落子无悔”，但万一手抖了呢？
  - <kbd>Ctrl</kbd> + <kbd>Y</kbd> ：未实装。
  - <kbd>Ctrl</kbd> + <kbd>S</kbd> ：把当前局面保存在内存中。
    - 象棋不是ギャルゲー，就算能存盘，你也只能有一个存档位。在存盘时，旧的存档（如果有）会被覆盖。
  - <kbd>Ctrl</kbd> + <kbd>L</kbd> ：读取内存中的局面。可以用 <kbd>Ctrl</kbd> + <kbd>Z</kbd> 撤销。
  - <kbd>Ctrl</kbd> + <kbd>R</kbd> ：~~掀桌~~ 把局面恢复到初始状态。可以用 <kbd>Ctrl</kbd> + <kbd>Z</kbd> 撤销。
    - 已知Bug：任意行棋后用 <kbd>Ctrl</kbd> + <kbd>R</kbd> 掀桌多次，会在历史记录中创造多个初始盘面，也就是说要多摁相应次数的 <kbd>Ctrl</kbd> + <kbd>Z</kbd> 才能撤销到掀桌前的盘面。

## 核心机制

好吧，虽然一开始我想复刻象棋完整规则，但是现在看来似乎有些难度。
- 合法行棋判定
  - 可以说是最基础的逻辑了。如果行棋后会导致你被将军，会有奇怪的提示音告诉你这步棋是不合法的。
- 将杀判定。虽然做出来了，但十分粗糙。
  - 如果某方形成了绝杀，那么你会看到被杀方的将/帅变成了……“蘑”(?)
  - 在盘面上棋子数量较多的时候，要近两秒才能爆搜完毕确定将杀。（这里有很大改进空间，确切算法也有了，但没太多时间码代码了）
  - 困毙和此判定同理。因此没有特判困毙。
- 其他。如长将判负等
  - **完全没有**此功能
  - 理由是，即使优化了算法，“长杀”判定的时间复杂度也是爆搜无法接受的。因为实战中会出现一方长杀、一方长将的情况（这种情况下本应判为和棋），如果直接判为长将方败显然有失公正。
  - 此外，同为长禁着的“长捉”的概念涉及到多回合搜索、甚至是子力价值模型（以区别于邀兑）。在没有现成模型的情况下**完全无法**在合理时间复杂度内实现。因此我放弃了这方面功能的开发。

- 动画效果
  - 咕咕咕
